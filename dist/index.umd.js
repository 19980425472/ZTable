(function(b,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue"),require("element-plus")):typeof define=="function"&&define.amd?define(["exports","vue","element-plus"],n):(b=typeof globalThis<"u"?globalThis:b||self,n(b.ZTable={},b.Vue,b.ElementPlus))})(this,function(b,n,w){"use strict";const A="--",P="\u52A0\u8F7D\u4E2D...",j="\u52A0\u8F7D\u5931\u8D25",x=n.defineComponent({__name:"index",props:{dataSource:{},columns:{},globalPlaceholder:{}},emits:["select","select-all","selection-change","cell-mouse-enter","cell-mouse-leave","cell-click","cell-dblclick","cell-contextmenu","row-click","row-contextmenu","row-dblclick","header-click","header-contextmenu","sort-change","filter-change","current-change","header-dragend","expand-change","scroll"],setup(T,{expose:I,emit:H}){const $=T,M=H,s=n.ref(null),k=n.ref([]),p=n.ref(Date.now()),B=e=>!!(e===""||e===null||e===void 0||typeof e=="number"&&(isNaN(e)||!isFinite(e))),U=(e,t)=>{if(!(!e||!t||typeof e!="object"))return t.split(".").reduce((l,i)=>{if(l!=null){if(Array.isArray(l)&&/^\d+$/.test(i)){const a=parseInt(i);return a>=0&&a<l.length?l[a]:void 0}if(typeof l=="object"&&i in l)return l[i]}},e)},C=e=>e&&typeof e=="object"&&"__v_isVNode"in e,d=(e,...t)=>{M(e,...t)},V=n.defineComponent({name:"TableAsyncFormatter",props:{value:{type:Object,required:!0,validator:e=>typeof e=="object"&&!Array.isArray(e)},formatter:{type:Function,required:!0},loadingPlaceholder:{type:String,default:P},errorPlaceholder:{type:String,default:j},emptyPlaceholder:{type:String,default:A}},setup(e){const t=n.ref(null),l=n.ref(null),i=n.ref(!0),a=n.ref(null),m=async()=>{if(!!i.value){if(a.value)return a.value;try{t.value=null,l.value=null,a.value=e.formatter(e.value);const o=await a.value;i.value&&(t.value=C(o)||typeof o=="string"?o:e.emptyPlaceholder)}catch(o){i.value&&(console.warn("[TablePro] \u5F02\u6B65\u683C\u5F0F\u5316\u5931\u8D25:",o),l.value=o,t.value=null)}finally{a.value=null}}};return m(),n.watch(()=>e.value,m,{deep:!0}),n.onUnmounted(()=>{i.value=!1}),()=>l.value?e.errorPlaceholder:t.value===null&&a.value?e.loadingPlaceholder:C(t.value)?t.value:n.h("span",null,t.value)}}),O=n.defineComponent({name:"TableRenderColumn",props:{column:{type:Object,required:!0},index:{type:Number,required:!0},parentProps:{type:Object,default:()=>({})},level:{type:Number,default:0}},setup(e){const t=n.inject("tableConfig");if(!t)throw new Error("[TablePro] \u672A\u63D0\u4F9B\u8868\u683C\u5168\u5C40\u914D\u7F6E");const{getColumnProps:l,getColumnEvents:i,getCellValue:a,getColKey:m}=t;if(e.level>5)return console.warn(`[TablePro] \u8868\u683C\u5217\u9012\u5F52\u6DF1\u5EA6\u8D85\u8FC7 ${5} \u7EA7`),()=>null;const o=(r,c)=>u=>{try{if(r.renderHeader){const f=n.unref(r.renderHeader({...u,column:r,$index:c,row:u.row}));return C(f)||typeof f=="string"?f:r.title||r.label||""}return r.title||r.label||""}catch(f){return console.warn("[TablePro] \u8868\u5934\u6E32\u67D3\u5931\u8D25:",f),"\u6E32\u67D3\u5931\u8D25"}},y=r=>c=>{var u;if((u=r.children)!=null&&u.length)return null;try{if(r.render){const g=n.unref(r.render({...c,column:r,cell:c.cell}));if(C(g))return g;if(typeof g=="string"||typeof g=="number")return n.h("span",null,g)}if(r.slot){const g=c.$slots[r.slot];if(g)return g({row:c.row,column:r,$index:c.$index,cell:c.cell})}const f=a(c.row,r);return C(f)?f:n.h("span",null,f)}catch(f){return console.warn("[TablePro] \u5355\u5143\u683C\u6E32\u67D3\u5931\u8D25:",f),n.h("span",{style:"color: #f56c6c"},"\u6E32\u67D3\u5931\u8D25")}},D=()=>{var c;if(!((c=e.column.children)!=null&&c.length))return null;const r=l(e.column,e.parentProps,e.level);return e.column.children.map((u,f)=>{var F;const g=e.level+1,R=m(u,f,g);return(F=u.children)!=null&&F.length?n.h(O,{column:u,index:f,parentProps:r,level:g,key:R}):n.h(w.ElTableColumn,{...l(u,r,g),...i(u),key:R},{header:o(u,f),default:S=>y(u)({...S,column:u,cell:S.cell}),...Object.fromEntries(Object.entries(u.slots||{}).map(([S,X])=>[S,Z=>X({...Z,column:u})]))})})},h=l(e.column,e.parentProps,e.level),v=i(e.column),E=m(e.column,e.index,e.level);return()=>["selection","index","expand"].includes(e.column.type||"")?n.h(w.ElTableColumn,{...h,...v,key:E},{header:o(e.column,e.index),default:e.column.type==="expand"?y(e.column):void 0,...Object.fromEntries(Object.entries(e.column.slots||{}).map(([r,c])=>[r,u=>c({...u,column:e.column})]))}):n.h(w.ElTableColumn,{...h,...v,key:E},{header:o(e.column,e.index),default:e.column.children?D:r=>y(e.column)({...r,column:e.column,cell:r.cell}),...Object.fromEntries(Object.entries(e.column.slots||{}).map(([r,c])=>[r,u=>c({...u,column:e.column})]))})}}),K=n.computed(()=>{const e=t=>t.filter(l=>l.visible!==!1).map(l=>{var i;if((i=l.children)!=null&&i.length){const a=e(l.children);return a.length?{...l,children:a}:null}return l}).filter(l=>!!l);return e($.columns)}),L=(e,t,l)=>{const i=e.fixed?`fixed-${e.fixed}`:"fixed-none";return`${e.dataIndex||e.prop||e.key||e.type||`col-${t}`}-level-${l}-${i}-${p.value}`},W=(e,t={},l=0)=>{var m,o,y,D,h,v,E,r,c;const a={id:(()=>e.key?`table-col-${e.key}-level-${l}`:`table-col-${e.dataIndex||e.prop||Date.now()}-level-${l}`)(),level:l,prop:e.dataIndex||e.prop,label:e.title||e.label,width:(m=e.width)!=null?m:t.width,minWidth:(o=e.minWidth)!=null?o:t.minWidth,fixed:(y=e.fixed)!=null?y:t.fixed,align:(D=e.align)!=null?D:t.align,headerAlign:(h=e.headerAlign)!=null?h:t.headerAlign,sortable:(v=e.sortable)!=null?v:!1,resizable:(r=(E=e.resizable)!=null?E:t.resizable)!=null?r:!0,showOverflowTooltip:(c=e.showOverflowTooltip)!=null?c:t.showOverflowTooltip,cellStyle:e.cellStyle||t.cellStyle,headerCellStyle:e.headerCellStyle||t.headerCellStyle,className:e.className,labelClassName:e.labelClassName,selectable:e.selectable,reserveSelection:e.reserveSelection,filters:e.filters,filterPlacement:e.filterPlacement,filterMultiple:e.filterMultiple,filterMethod:e.filterMethod,filteredValue:e.filteredValue,sortMethod:e.sortMethod,sortBy:e.sortBy,sortOrders:e.sortOrders,index:e.index,...e.extraProps};switch(e.type){case"selection":Object.assign(a,{type:"selection",width:e.width||55});break;case"index":Object.assign(a,{type:"index",width:e.width||60});break;case"expand":a.type="expand";break}return a},q=e=>({...e.events||{}}),z=(e,t)=>{const l=n.inject("tableConfig"),i=(l==null?void 0:l.globalPlaceholder)||A,a=t.placeholder||i,m=t.dataIndex||t.prop;if(!m)return a;try{const o=U(e,m);if(o===void 0||B(o))return a;if(t.formatter)return t.formatter(e,t,o);if(typeof o=="object"&&!Array.isArray(o)){if(t.formatObjectAsync)return n.h(V,{value:o,formatter:t.formatObjectAsync,loadingPlaceholder:t.loadingPlaceholder||P,emptyPlaceholder:a});if(t.formatObject){const y=t.formatObject(o);return C(y)?y:y.toString()}return JSON.stringify(o)}return Array.isArray(o)?o.join(", "):o}catch(o){return console.warn("[TablePro] \u83B7\u53D6\u5355\u5143\u683C\u503C\u9519\u8BEF:",o),a}};return n.watch(()=>$.columns,()=>{p.value=Date.now(),n.nextTick(()=>{var e;return(e=s.value)==null?void 0:e.doLayout()})},{deep:!0,flush:"post"}),n.onMounted(()=>{n.nextTick(()=>{var e;return(e=s.value)==null?void 0:e.doLayout()})}),n.provide("tableConfig",{getColumnProps:W,getColumnEvents:q,getCellValue:z,getColKey:L,globalPlaceholder:$.globalPlaceholder||A}),I({clearSelection:()=>{var e;return(e=s.value)==null?void 0:e.clearSelection()},getSelectionRows:()=>{var e;return((e=s.value)==null?void 0:e.getSelectionRows())||[]},toggleRowSelection:(e,t)=>{var l;return(l=s.value)==null?void 0:l.toggleRowSelection(e,t)},toggleAllSelection:()=>{var e;return(e=s.value)==null?void 0:e.toggleAllSelection()},toggleRowExpansion:(e,t)=>{var l;return(l=s.value)==null?void 0:l.toggleRowExpansion(e,t)},setCurrentRow:e=>{var t;return(t=s.value)==null?void 0:t.setCurrentRow(e)},clearSort:()=>{var e;return(e=s.value)==null?void 0:e.clearSort()},clearFilter:e=>{var t;return(t=s.value)==null?void 0:t.clearFilter(e)},doLayout:()=>{var e;return(e=s.value)==null?void 0:e.doLayout()},sort:(e,t)=>{var l;return(l=s.value)==null?void 0:l.sort(e,t)},scrollTo:(e,t)=>{var l;return(l=s.value)==null?void 0:l.scrollTo(e,t)},setScrollTop:e=>{var t;return(t=s.value)==null?void 0:t.setScrollTop(e)},setScrollLeft:e=>{var t;return(t=s.value)==null?void 0:t.setScrollLeft(e)},getTableInstance:()=>s.value,get columns(){var e;return((e=s.value)==null?void 0:e.columns)||[]},updateKeyChildren:(e,t)=>{var l;return(l=s.value)==null?void 0:l.updateKeyChildren(e,t)}}),(e,t)=>(n.openBlock(),n.createBlock(n.unref(w.ElTable),n.mergeProps(e.$attrs,{data:e.dataSource,selection:k.value,"onUpdate:selection":t[0]||(t[0]=l=>k.value=l),ref_key:"tableRef",ref:s,key:p.value,onSelect:t[1]||(t[1]=l=>d("select",...arguments)),onSelectAll:t[2]||(t[2]=l=>d("select-all",...arguments)),onSelectionChange:t[3]||(t[3]=l=>d("selection-change",...arguments)),onCellMouseEnter:t[4]||(t[4]=l=>d("cell-mouse-enter",...arguments)),onCellMouseLeave:t[5]||(t[5]=l=>d("cell-mouse-leave",...arguments)),onCellClick:t[6]||(t[6]=l=>d("cell-click",...arguments)),onCellDblclick:t[7]||(t[7]=l=>d("cell-dblclick",...arguments)),onCellContextmenu:t[8]||(t[8]=l=>d("cell-contextmenu",...arguments)),onRowClick:t[9]||(t[9]=l=>d("row-click",...arguments)),onRowContextmenu:t[10]||(t[10]=l=>d("row-contextmenu",...arguments)),onRowDblclick:t[11]||(t[11]=l=>d("row-dblclick",...arguments)),onHeaderClick:t[12]||(t[12]=l=>d("header-click",...arguments)),onHeaderContextmenu:t[13]||(t[13]=l=>d("header-contextmenu",...arguments)),onSortChange:t[14]||(t[14]=l=>d("sort-change",...arguments)),onFilterChange:t[15]||(t[15]=l=>d("filter-change",...arguments)),onCurrentChange:t[16]||(t[16]=l=>d("current-change",...arguments)),onHeaderDragend:t[17]||(t[17]=l=>d("header-dragend",...arguments)),onExpandChange:t[18]||(t[18]=l=>d("expand-change",...arguments)),onScroll:t[19]||(t[19]=l=>d("scroll",...arguments))}),n.createSlots({default:n.withCtx(()=>[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(K.value,(l,i)=>(n.openBlock(),n.createBlock(n.unref(O),{key:L(l,i,0),column:l,index:i,"parent-props":{},level:0},null,8,["column","index"]))),128))]),_:2},[n.renderList(Object.keys(e.$slots),l=>({name:l,fn:n.withCtx(i=>[n.renderSlot(e.$slots,l,n.normalizeProps(n.guardReactiveProps(i)))])}))]),1040,["data","selection"]))}}),N=T=>{T.component("ZTable",x),T.component("z-table",x)};b.ZTable=x,b.default=x,b.install=N,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
